<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ray Chen" />

<meta name="date" content="2019-11-26" />

<title>RC_exploratory_analyses</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
<li class="dropdown-header">Examples</li>
<li>
  <a href="https://github.com/davedestep/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">RC_exploratory_analyses</h1>
<h4 class="author">Ray Chen</h4>
<h4 class="date">11/26/2019</h4>

</div>


<div id="initial-data-loading" class="section level2">
<h2>Initial data loading</h2>
<pre class="r"><code>files = list.files(&quot;./PRSA_Data_20130301-20170228&quot;, full.names = TRUE)

all_df = map_df(files, read_csv) %&gt;% 
  bind_rows() %&gt;% 
  janitor::clean_names()</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )
## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )
## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )
## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )
## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )
## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )
## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )
## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )
## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )
## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )
## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )
## Parsed with column specification:
## cols(
##   No = col_double(),
##   year = col_double(),
##   month = col_double(),
##   day = col_double(),
##   hour = col_double(),
##   PM2.5 = col_double(),
##   PM10 = col_double(),
##   SO2 = col_double(),
##   NO2 = col_double(),
##   CO = col_double(),
##   O3 = col_double(),
##   TEMP = col_double(),
##   PRES = col_double(),
##   DEWP = col_double(),
##   RAIN = col_double(),
##   wd = col_character(),
##   WSPM = col_double(),
##   station = col_character()
## )</code></pre>
</div>
<div id="characterizing-amount-of-data-and-missing-data" class="section level2">
<h2>Characterizing amount of data and missing data</h2>
<p>There are a total of 420768 rows/observations, and a total of 18 variables or columns which include the following: no, year, month, day, hour, pm2_5, pm10, so2, no2, co, o3, temp, pres, dewp, rain, wd, wspm, station.</p>
<p>Total amount of data:</p>
<pre class="r"><code>colSums(!is.na(all_df))</code></pre>
<pre><code>##      no    year   month     day    hour   pm2_5    pm10     so2     no2 
##  420768  420768  420768  420768  420768  412029  414319  411747  408652 
##      co      o3    temp    pres    dewp    rain      wd    wspm station 
##  400067  407491  420370  420375  420365  420378  418946  420450  420768</code></pre>
<p>Amount of missing data for each variable:</p>
<pre class="r"><code>colSums(is.na(all_df))</code></pre>
<pre><code>##      no    year   month     day    hour   pm2_5    pm10     so2     no2 
##       0       0       0       0       0    8739    6449    9021   12116 
##      co      o3    temp    pres    dewp    rain      wd    wspm station 
##   20701   13277     398     393     403     390    1822     318       0</code></pre>
<p>Appears that all rows have date, time, and station information. The number of complete rows/observations with all rows filled in is 382168 which represents the vast majority of the observations.</p>
</div>
<div id="some-cleaning" class="section level2">
<h2>Some cleaning</h2>
<p>There is a column/variable ‘no’ which just seems to count rows, which is not needed so we are removing this. We will also change wd and station into factors, and create new variables called date (which combines month, day, year) and season.</p>
<pre class="r"><code>all_df = 
  all_df %&gt;% 
  select(-no) %&gt;% 
  mutate(
    wd = as.factor(wd),
    station = as.factor(station),
    date = as.Date(str_c(year, &#39;-&#39;, month, &#39;-&#39;, day)),
    season = case_when(
      (month &lt; 3) ~ &quot;winter&quot;, #start of Spring is 3/20
      (month == 3 &amp; day &lt; 20) ~ &quot;winter&quot;,
      (month &lt; 6) ~ &quot;spring&quot;, #start of Summer is 6/21
      (month == 6 &amp; day &lt; 21) ~ &quot;spring&quot;,
      (month &lt; 9) ~ &quot;summer&quot;, #start of Fall is 9/22
      (month == 9 &amp; day &lt; 22) ~ &quot;summer&quot;,
      (month &lt; 12) ~ &quot;fall&quot;, #start of Winter is 12/21
      (month == 12 &amp; day &lt; 21) ~ &quot;fall&quot;,
      (month == 12 &amp; day &gt;= 21) ~ &quot;winter&quot;
    )
  )</code></pre>
</div>
<div id="missing-data-visualization" class="section level2">
<h2>Missing data visualization</h2>
<p>Visualizing the missing data over time</p>
<pre class="r"><code>missing = all_df %&gt;% 
  select(-season) %&gt;% 
  is.na() %&gt;% 
  as_tibble() %&gt;% 
  mutate(
    date = all_df$date,
    station = all_df$station
  ) %&gt;% 
  pivot_longer(
    cols = year:wspm
  ) 

missing %&gt;% 
  ggplot(aes(x =date, y = name, fill = value)) + 
  geom_raster(alpha=0.8) + 
  scale_fill_discrete(name = &quot;&quot;, labels = c(&quot;Present&quot;, &quot;Missing&quot;)) +
  labs(x = &quot;Variable&quot;,y = &quot;Date&quot;, title = &quot;Missing values over time by station&quot;) +
  coord_flip() </code></pre>
<p><img src="RC_exploratory_analyses_files/figure-html/unnamed-chunk-5-1.png" width="90%" /></p>
<p>And now visualizing missing data over time across stations:</p>
<pre class="r"><code>missing %&gt;% 
  ggplot(aes(x =date, y = name, fill = value)) + 
  geom_raster(alpha=0.8) + 
  scale_fill_discrete(name = &quot;&quot;, labels = c(&quot;Missing&quot;, &quot;Present&quot;)) +
  labs(x = &quot;Variable&quot;,y = &quot;Date&quot;, title = &quot;Missing values over time by station&quot;) +
  facet_grid(station~.) </code></pre>
<p><img src="RC_exploratory_analyses_files/figure-html/unnamed-chunk-6-1.png" width="90%" /></p>
</div>
<div id="looking-at-outcomes" class="section level2">
<h2>Looking at outcomes</h2>
<p>Our primary outcome of interest is PM2.5, and can be summarized as follows: 2, 20, 55, 79.7934281, 111, 999, 8739</p>
<p>Looking at PM2.5 over time:</p>
<pre class="r"><code>all_df %&gt;% 
  ggplot(aes(x = date, y = pm2_5)) +
  geom_point() +
  geom_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="RC_exploratory_analyses_files/figure-html/unnamed-chunk-7-1.png" width="90%" /></p>
<p>Looking at PM2.5 over time by station:</p>
<pre class="r"><code>all_df %&gt;% 
  ggplot(aes(x = date, y = pm2_5)) +
  geom_point() +
  geom_smooth() +
  facet_grid(~station)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="RC_exploratory_analyses_files/figure-html/unnamed-chunk-8-1.png" width="90%" /></p>
<p>Looking at PM2.5 by seasons:</p>
<pre class="r"><code>all_df %&gt;% 
  mutate(
    fct_reorder(season, pm2_5)
  ) %&gt;% 
  ggplot(aes(x = season, y = pm2_5)) + 
  geom_boxplot()</code></pre>
<p><img src="RC_exploratory_analyses_files/figure-html/unnamed-chunk-9-1.png" width="90%" /></p>
<p>Kind of hard to distinguish, will try limiting scale of y-axis and try a violin plot</p>
<pre class="r"><code>all_df %&gt;% 
  mutate(
    fct_reorder(season, pm2_5)
  ) %&gt;% 
  ggplot(aes(x = season, y = pm2_5)) + 
  geom_boxplot() + 
  ylim(0, 250)</code></pre>
<p><img src="RC_exploratory_analyses_files/figure-html/unnamed-chunk-10-1.png" width="90%" /></p>
<pre class="r"><code>all_df %&gt;% 
  mutate(
    fct_reorder(season, pm2_5)
  ) %&gt;% 
  ggplot(aes(x = season, y = pm2_5)) + 
  geom_violin() + 
  ylim(0, 250)</code></pre>
<p><img src="RC_exploratory_analyses_files/figure-html/unnamed-chunk-10-2.png" width="90%" /> Overall seems fairly similar across seasons, but technically highest in the winter with a number of very high outlier values as well</p>
</div>
<div id="plotting-everything" class="section level2">
<h2>Plotting everything</h2>
<p>Looking at scatter plots of every variable against PM2.5 to look for potential correlation</p>
<pre class="r"><code>## Just FYI, this takes a long time to run. And the plots will take up 900MB of memory
#So for now I&#39;ve set eval=false, but I&#39;m pushing the image it generated, called all_variables_plot.png
par(mfrow = c(4, 5))

vars = all_df %&gt;% select(-pm2_5, -year, -month, -day, -date, -season) %&gt;% colnames()
plots = list()
for (i in 1:length(vars)) {
  plots[[i]] = ggplot(all_df, aes_string(x = vars[i], y = &quot;pm2_5&quot;)) + geom_point()
}
do.call(grid.arrange, plots)</code></pre>
<p>Variables which seem correlated with PM2.5 include (not surprisingly) PM10, but also rain, wind speed, o3 all seem to be strongly correlated. In addition, no2, so2, and possibly temperature, pressure and dew point but in a non-linear fashion</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
