<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Project Report</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://www.youtube.com/watch?v=M3XAVKuDJAY">Screencast</a>
</li>
<li>
  <a href="report.html">Project Report</a>
</li>
<li>
  <a href="https://davdestep.shinyapps.io/two_panel_dashboard">Shiny Dashboard</a>
</li>
<li>
  <a href="map.html">Pollution Map</a>
</li>
<li>
  <a href="https://github.com/davedestep/p8105-Final-Project">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="mailto:&lt;***@cumc.columbia.edu&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Project Report</h1>

</div>


<p><em>David DeStephano dd2948, Connor Goldman cg3112, Sarah Munro sim2128, RuiJun Chen rc3179</em> <em>Dec 5, 2019</em></p>
<p><br></p>
<div id="motivation" class="section level1">
<h1>Motivation</h1>
<p>Human health is inextricably linked to the quality of the air we breath we every day. Outdoor air comprises a significant portion of our lifetime air exposure, and the quality of that air has been declining for some time. Air pollution is increasingly recognized as a factor contributing to global morbidity and mortality, particularly with respect to cardiovascular and respiratory health. In 2018, The World Health Organization released a report stating that:</p>
<p>→ 91% of the world population lived in places where WHO air quality guidelines were not met → Air pollution was estimated to cause 4.2 million premature deaths worldwide in 201 → Reduction in pollution would reduce the global burden of disease from heart disease, stroke, lung cancer, and chronic and acute respiratory diseases</p>
<p>**From <a href="https://www.who.int/news-room/fact-sheets/detail/ambient-(outdoor)-air-quality-and-health">WHO</a></p>
</div>
<div id="goals" class="section level1">
<h1>Goals</h1>
<p>There is a long way to go in improving ambient air quality, but there is a lot to be gained in doing so. Improved monitoring of factors that influence pollution, and increased awareness of associated health risks can advance the road to recovery. Through this project we strive to:</p>
<p>→ Replicate an air quality monitoring system that could be utilized by a government or health entity → Assess meteorological data as a predictor of air quality → Identify temporal trends, if any → Look for associations between air quality and cardiovascular health</p>
</div>
<div id="related-work" class="section level1">
<h1>Related Work</h1>
<p>After finding the dataset, we performed a literature review and were inspired by several studies to examine predictors of PM 2.5 and whether pollutants affect CVD hospitalizations. There has been some evidence that air pollutants such as PM10, nitroden diaxide (NO2), and carbon monoxide (CO) contribute to cardiovascular disease and related deaths <a href="https://www.nature.com/articles/jes201621.pdf?origin=ppub">Nature</a>. We wanted to examine this relationship when taking into account meteorological and temporal factors, as there has been a link between time of year and temperature with the occurence of heart attack.</p>
</div>
<div id="initial-questions" class="section level1">
<h1>Initial Questions</h1>
<p>What meteorological factors are associated with increased PM 2.5 in different sites around Beijing. How are these numbers changing over time?</p>
</div>
<div id="our-data" class="section level1">
<h1>Our Data</h1>
<p>Beijing is one of the industrial capitals of the world, and a notorious source of air pollution. For our primary analyses we looked at a dataset describing meteorological and air quality data from 12 sites in Beijing, China over the years 2013 - 2017. This data comes from <a href="http://archive.ics.uci.edu/ml/index.php">The UCI Machine Learning Repository</a>. Air quality was measured as a concentration of particulate matter 2.5 (PM2.5) and particulate matter 10 (PM10). PM2.5 is associated with greater health risks, because the smaller size (&lt;2.5um) makes it more efficient at penetrating deeper into the respiratory system. For this reason we chose to analyze PM2.5 as the outcome of interest. (<a href="https://www3.epa.gov/ttn/amtic/files/ambient/pm25/spec/drispec.pdf" class="uri">https://www3.epa.gov/ttn/amtic/files/ambient/pm25/spec/drispec.pdf</a>).</p>
<p>Our air pollution dataset included the following variables:</p>
<ul>
<li>No: row number</li>
<li>year: year of data in this row</li>
<li>month: month of data in this row</li>
<li>day: day of data in this row</li>
<li>hour: hour of data in this row</li>
<li>PM2.5: PM2.5 concentration (ug/m^3)</li>
<li>PM10: PM10 concentration (ug/m^3)</li>
<li>SO2: SO2 concentration (ug/m^3)</li>
<li>NO2: NO2 concentration (ug/m^3)</li>
<li>CO: CO concentration (ug/m^3)</li>
<li>O3: O3 concentration (ug/m^3)</li>
<li>TEMP: temperature (degree Celsius)</li>
<li>PRES: pressure (hPa)</li>
<li>DEWP: dew point temperature (degree Celsius)</li>
<li>RAIN: precipitation (mm)</li>
<li>wd: wind direction</li>
<li>WSPM: wind speed (m/s)</li>
<li>station: name of the air-quality monitoring site</li>
</ul>
<p>For our secondary analyses, we sought to isolate any associations between air quality and health outcomes in Beijing. We modeled acute myocardial infarction (AMI) as the outcome using the dataset from <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0204706">Liu et al.</a>. The data was collected by the public health information center of Beijing, and includes AMI hospital admissions in Beijing for each month between January 1, 2013 and December 31, 2016.</p>
<p>The following variables were included:</p>
<ul>
<li>Gender<br />
</li>
<li>Admission date(year)<br />
</li>
<li>Admission date(month)</li>
<li>Main discharge diagnosis</li>
</ul>
</div>
<div id="exploratory-analysis" class="section level1">
<h1>Exploratory Analysis</h1>
<div id="loading-and-tidying-the-data" class="section level3">
<h3>Loading and tidying the data</h3>
<p>We loaded the data from csv files obtained from the data archive listed above</p>
<pre class="r"><code>files = list.files(&quot;./PRSA_Data_20130301-20170228&quot;, full.names = TRUE)

all_df = map_df(files, read_csv) %&gt;% 
  bind_rows() %&gt;% 
  janitor::clean_names()</code></pre>
<p>We identified a total of 420768 rows/observations, and a total of 18 variables or columns which include the following: no, year, month, day, hour, pm2_5, pm10, so2, no2, co, o3, temp, pres, dewp, rain, wd, wspm, station. We then wanted to characterize the amount of data present and missing for each variable:</p>
</div>
<div id="total-amount-of-data" class="section level2">
<h2>Total amount of data:</h2>
<pre class="r"><code>colSums(!is.na(all_df))</code></pre>
<pre><code>##      no    year   month     day    hour   pm2_5    pm10     so2     no2 
##  420768  420768  420768  420768  420768  412029  414319  411747  408652 
##      co      o3    temp    pres    dewp    rain      wd    wspm station 
##  400067  407491  420370  420375  420365  420378  418946  420450  420768</code></pre>
</div>
<div id="amount-of-missing-data-for-each-variable" class="section level2">
<h2>Amount of missing data for each variable:</h2>
<pre class="r"><code>colSums(is.na(all_df))</code></pre>
<pre><code>##      no    year   month     day    hour   pm2_5    pm10     so2     no2 
##       0       0       0       0       0    8739    6449    9021   12116 
##      co      o3    temp    pres    dewp    rain      wd    wspm station 
##   20701   13277     398     393     403     390    1822     318       0</code></pre>
<p>From this, it appears that all observations(rows) have date, time, and station information. The number of complete observations with all variables filled in is 382168 which represents the vast majority of the observations.</p>
<p>In tidying the data, we found there is a column/variable ‘no’ which just seems to count rows, which is not needed and removed. We also changed wd and station into factors, added seasons, and created a variable for seasonal years (since winter spans over two years, this variable was created to only be coded as the year in which winter began). Date and datetime variables were also created.</p>
<pre class="r"><code>all_df = 
  all_df %&gt;% 
  select(-no) %&gt;% 
  mutate(
    wd = as.factor(wd),
    station = as.factor(station),
    date = as.Date(str_c(year, &#39;-&#39;, month, &#39;-&#39;, day)),
    datetime = as.POSIXct(str_c(year, &#39;-&#39;, month, &#39;-&#39;, day, &#39; &#39;, &quot;00:&quot;, hour,&quot;:00&quot;)),
    season = case_when(
      (month &lt; 3) ~ &quot;winter&quot;, #start of Spring is 3/20
      (month == 3 &amp; day &lt; 20) ~ &quot;winter&quot;,
      (month &lt; 6) ~ &quot;spring&quot;, #start of Summer is 6/21
      (month == 6 &amp; day &lt; 21) ~ &quot;spring&quot;,
      (month &lt; 9) ~ &quot;summer&quot;, #start of Fall is 9/22
      (month == 9 &amp; day &lt; 22) ~ &quot;summer&quot;,
      (month &lt; 12) ~ &quot;fall&quot;, #start of Winter is 12/21
      (month == 12 &amp; day &lt; 21) ~ &quot;fall&quot;,
      (month == 12 &amp; day &gt;= 21) ~ &quot;winter&quot;
    ),
    seasonal_year=if_else(month&lt;4 &amp; season==&quot;winter&quot; &amp; year ==2014, 2013,
                          if_else(month &lt; 4 &amp; season==&quot;winter&quot; &amp; year ==2015, 2014,
                           if_else(month &lt; 4 &amp; season==&quot;winter&quot; &amp; year ==2016, 2015,
                            if_else(month &lt; 4 &amp; season==&quot;winter&quot; &amp; year ==2017, 2016, year)))),
    season_and= paste(season, &quot; &quot;, seasonal_year)
  )</code></pre>
</div>
<div id="visualizing-the-missing-data-over-time" class="section level2">
<h2>Visualizing the missing data over time</h2>
<pre class="r"><code>missing = all_df %&gt;% 
  select(-year, -season, -seasonal_year, -season_and, -datetime, -month, -day, -hour) %&gt;% #the original data except the ones we know are complete
  is.na() %&gt;% 
  as_tibble() %&gt;% 
  mutate(
    date = all_df$date,
    station = all_df$station
  ) %&gt;% 
  pivot_longer(
    cols = pm2_5:wspm
  ) 

missing %&gt;% 
  ggplot(aes(x =date, y = name, fill = value)) + 
  geom_raster(alpha=0.8) + 
  scale_fill_discrete(name = &quot;&quot;, labels = c(&quot;Present&quot;, &quot;Missing&quot;)) +
  labs(x = &quot;Variable&quot;,y = &quot;Date&quot;, title = &quot;Missing values over time&quot;) +
  coord_flip() </code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-5-1.png" width="90%" /></p>
</div>
<div id="and-now-visualizing-missing-data-over-time-across-stations" class="section level2">
<h2>And now visualizing missing data over time across stations:</h2>
<pre class="r"><code>missing %&gt;% 
  ggplot(aes(x =date, y = name, fill = value)) + 
  geom_raster(alpha=0.8) + 
  scale_fill_discrete(name = &quot;&quot;, labels = c(&quot;Missing&quot;, &quot;Present&quot;)) +
  labs(x = &quot;Time&quot;,y = &quot;Variable&quot;, title = &quot;Missing values over time by station&quot;) +
  facet_grid(station~.) </code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-6-1.png" width="90%" /></p>
<p>Our primary outcome of interest is PM2.5, and can be summarized as follows:</p>
<pre class="r"><code>all_df %&gt;% pull(pm2_5) %&gt;% summary</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##    2.00   20.00   55.00   79.79  111.00  999.00    8739</code></pre>
<div id="looking-at-pm2.5-over-time" class="section level3">
<h3>Looking at PM2.5 over time:</h3>
<pre class="r"><code>summary</code></pre>
<pre><code>## standardGeneric for &quot;summary&quot; defined from package &quot;base&quot;
## 
## function (object, ...) 
## standardGeneric(&quot;summary&quot;)
## &lt;environment: 0x000000001ee4f700&gt;
## Methods may be defined for arguments: object
## Use  showMethods(&quot;summary&quot;)  for currently available ones.</code></pre>
<pre class="r"><code>all_df %&gt;% 
  ggplot(aes(x = date, y = pm2_5)) +
  geom_point() +
  geom_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-8-1.png" width="90%" /></p>
</div>
<div id="looking-at-pm2.5-over-time-by-station" class="section level3">
<h3>Looking at PM2.5 over time by station:</h3>
<pre class="r"><code>all_df %&gt;% 
  ggplot(aes(x = date, y = pm2_5)) +
  geom_point() +
  geom_smooth() +
  facet_grid(~station)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-9-1.png" width="90%" /></p>
</div>
<div id="looking-at-pm2.5-by-seasons" class="section level3">
<h3>Looking at PM2.5 by seasons:</h3>
<pre class="r"><code>all_df %&gt;% 
  mutate(
    fct_reorder(season, pm2_5)
  ) %&gt;% 
  ggplot(aes(x = season, y = pm2_5)) + 
  geom_boxplot()</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-10-1.png" width="90%" /></p>
</div>
<div id="kind-of-hard-to-distinguish-will-try-limiting-scale-of-y-axis-and-try-a-violin-plot" class="section level3">
<h3>Kind of hard to distinguish, will try limiting scale of y-axis and try a violin plot</h3>
<pre class="r"><code>all_df %&gt;% 
  mutate(
    fct_reorder(season, pm2_5)
  ) %&gt;% 
  ggplot(aes(x = season, y = pm2_5)) + 
  geom_boxplot() + 
  ylim(0, 250)</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-11-1.png" width="90%" /></p>
<pre class="r"><code>all_df %&gt;% 
  mutate(
    fct_reorder(season, pm2_5)
  ) %&gt;% 
  ggplot(aes(x = season, y = pm2_5)) + 
  geom_violin() + 
  ylim(0, 250)</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-11-2.png" width="90%" /></p>
<p>Overall seems fairly similar across seasons, but technically highest in the winter, with a number of very high outlier values as well</p>
</div>
<div id="average-pm-25-by-year-for-all-stations" class="section level3">
<h3>Average PM 25 by year for all stations</h3>
<pre class="r"><code>all_df %&gt;%  
  group_by(year) %&gt;% 
  summarize(avg_pm25=mean(pm2_5, na.rm = TRUE)) %&gt;% 
  ggplot(aes(x=year, y=avg_pm25)) +
  geom_line()</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-12-1.png" width="90%" /></p>
</div>
<div id="average-pm-25-by-year-for-each-station" class="section level3">
<h3>Average PM 25 by year for each station</h3>
<pre class="r"><code>all_df %&gt;%  
  group_by(year, station) %&gt;% 
  summarize(avg_pm25=mean(pm2_5, na.rm = TRUE)) %&gt;% 
  ggplot(aes(x=year, y=avg_pm25, color=station, group=station)) +
  geom_line()</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-13-1.png" width="90%" /></p>
<p>We can see that each individual station seems to follow the same yearly average pm 2.5 trend</p>
</div>
<div id="average-pm-25-by-year-and-season-for-each-station" class="section level3">
<h3>Average PM 25 by year and season for each station</h3>
<pre class="r"><code>all_df %&gt;%  
  group_by(season, seasonal_year, station) %&gt;% 
  summarize(avg_pm25=mean(pm2_5, na.rm = TRUE)) %&gt;% 
  ggplot(aes(x=season, y=avg_pm25, color=station, group=station)) +
  geom_line()+
  facet_wrap(seasonal_year~.) +
  ggtitle(&quot;Average PM2.5 by Seasonal Years&quot;)</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-14-1.png" width="90%" /></p>
</div>
<div id="average-pm-25-by-year-and-season-for-each-station-1" class="section level3">
<h3>Average PM 25 by year and season for each station</h3>
<pre class="r"><code>all_df %&gt;%  
  mutate(season_and=factor(season_and, levels = c(&quot;spring   2013&quot;, &quot;summer   2013&quot;, &quot;fall   2013&quot;, &quot;winter   2013&quot;,
                                                  &quot;spring   2014&quot;, &quot;summer   2014&quot;, &quot;fall   2014&quot;, &quot;winter   2014&quot;,
                                                  &quot;spring   2015&quot;, &quot;summer   2015&quot;, &quot;fall   2015&quot;, &quot;winter   2015&quot;,
                                                  &quot;spring   2016&quot;, &quot;summer   2016&quot;, &quot;fall   2016&quot;, &quot;winter   2016&quot;))) %&gt;% 
  group_by(season_and, station) %&gt;% 
  summarize(avg_pm25=mean(pm2_5, na.rm = TRUE)) %&gt;% 
  ggplot(aes(x=season_and, y=avg_pm25, color=station, group=station)) +
  geom_line()+
  ggtitle(&quot;Average PM2.5 by Seasonal Years&quot;) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-15-1.png" width="90%" /></p>
<pre class="r"><code>#need to change wspm to CUMULATIVE wind speed for month or direction
all_df %&gt;%  
  filter(station==&quot;Dingling&quot;) %&gt;% 
  ggplot(aes(x=dewp, y=wspm, color=pm2_5)) +
  geom_point(alpha=0.10) +
  scale_color_gradient(low=&quot;blue&quot;, high=&quot;red&quot;)</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-16-1.png" width="90%" /></p>
</div>
</div>
<div id="motherload-of-all-scatterplots-plotting-everything" class="section level2">
<h2>Motherload of all scatterplots (Plotting everything )</h2>
<p>Looking at scatter plots of every variable against PM2.5 to look for potential correlation</p>
<pre class="r"><code>## Just FYI, this takes a long time to run. And the plots will take up 900MB of memory
#So for now I&#39;ve set eval=false, but I&#39;m pushing the image it generated, called all_variables_plot.png
par(mfrow = c(4, 5))

vars = all_df %&gt;% select(-pm2_5, -year, -month, -day, -date, -season) %&gt;% colnames()
plots = list()
for (i in 1:length(vars)) {
  plots[[i]] = ggplot(all_df, aes_string(x = vars[i], y = &quot;pm2_5&quot;)) + geom_point()
}
do.call(grid.arrange, plots)</code></pre>
<div class="figure">
<img src="all_variables_plot.png" alt="all variables scatterplots" width="600" />
<p class="caption">all variables scatterplots</p>
</div>
</div>
<div id="pearson-correlation-coefficients" class="section level2">
<h2>Pearson Correlation Coefficients:</h2>
<pre class="r"><code>all_df %&gt;% 
  select(-wd, -station, -date, -datetime, -season, -seasonal_year, -season_and, -hour, -year, -month, -day) %&gt;% 
  map(as.numeric) %&gt;% 
  as.data.frame() %&gt;% 
  cor(use = &quot;complete.obs&quot;) %&gt;% 
  corrplot(method = &quot;square&quot;, addCoef.col = &quot;black&quot;, tl.col=&quot;black&quot;, tl.srt=45, insig = &quot;blank&quot;, 
         # hide correlation coefficient on the principal diagonal
         diag=FALSE, number.cex = .7)</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-18-1.png" width="90%" /></p>
</div>
<div id="findings" class="section level2">
<h2>Findings</h2>
<p>We looked at correlations between PM 2.5 and the meteorological variables, including dewpoint, windspeed.</p>
<p>We also calulcated spearman’s correlation coefficients to evaluate the inter-relations between air pollutants and weather conditions.</p>
<p>Temperature is correlated with our pollutant concentration, which are all also correlated with eachother, while windspeed has the most effect on decreasing the concentration of these pollutants.</p>
<p>Variables which seem correlated with PM2.5 include (not surprisingly) PM10, but also rain, wind speed, o3 all seem to be strongly correlated. In addition, no2, so2, and possibly temperature, pressure and dew point but in a non-linear fashion</p>
</div>
</div>
<div id="additional-analysis" class="section level1">
<h1>Additional Analysis</h1>
<p>Three models were developed for analysis of weather conditions and their association with PM2.5. A multivariable linear regression, a mixed model, and a Mixed Model for Longitudinal Continuous Data were developed to examine the variables of interest.</p>
<p>Almost every variable is significant, however, station, windspeed, season, and windspeed all have high effect sizes. Rain, dewpoint, temp also have moderate effect sizes.</p>
<div id="what-meteorological-variables-influence-pm-2.5" class="section level2">
<h2>What meteorological variables influence PM 2.5?</h2>
<div id="even-though-predictors-are-not-independent-will-model-using-linear-regression-before-a-longitudinal-model" class="section level3">
<h3>Even though predictors are not independent, will model using linear regression before a longitudinal model</h3>
<pre class="r"><code>###Remove timeseries variables:
reg&lt;-all_df %&gt;% select(-date,-datetime, -month,-day,-hour)

full &lt;- lm(pm2_5 ~ ., data = reg)

tab&lt;-full %&gt;% broom::tidy()
knitr::kable(tab, digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-2976.035</td>
<td align="right">582.399</td>
<td align="right">-5.110</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="right">5.810</td>
<td align="right">0.263</td>
<td align="right">22.091</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">pm10</td>
<td align="right">0.536</td>
<td align="right">0.001</td>
<td align="right">616.900</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">so2</td>
<td align="right">0.110</td>
<td align="right">0.003</td>
<td align="right">32.611</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">no2</td>
<td align="right">0.123</td>
<td align="right">0.003</td>
<td align="right">46.056</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">co</td>
<td align="right">0.019</td>
<td align="right">0.000</td>
<td align="right">256.446</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">o3</td>
<td align="right">0.106</td>
<td align="right">0.001</td>
<td align="right">77.453</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">-0.677</td>
<td align="right">0.013</td>
<td align="right">-52.532</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">pres</td>
<td align="right">0.299</td>
<td align="right">0.010</td>
<td align="right">30.721</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">dewp</td>
<td align="right">1.587</td>
<td align="right">0.009</td>
<td align="right">168.552</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">rain</td>
<td align="right">-0.335</td>
<td align="right">0.059</td>
<td align="right">-5.641</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wdENE</td>
<td align="right">-0.385</td>
<td align="right">0.248</td>
<td align="right">-1.550</td>
<td align="right">0.121</td>
</tr>
<tr class="odd">
<td align="left">wdESE</td>
<td align="right">1.117</td>
<td align="right">0.270</td>
<td align="right">4.136</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wdN</td>
<td align="right">0.547</td>
<td align="right">0.258</td>
<td align="right">2.118</td>
<td align="right">0.034</td>
</tr>
<tr class="odd">
<td align="left">wdNE</td>
<td align="right">0.125</td>
<td align="right">0.238</td>
<td align="right">0.523</td>
<td align="right">0.601</td>
</tr>
<tr class="even">
<td align="left">wdNNE</td>
<td align="right">0.045</td>
<td align="right">0.263</td>
<td align="right">0.172</td>
<td align="right">0.863</td>
</tr>
<tr class="odd">
<td align="left">wdNNW</td>
<td align="right">0.653</td>
<td align="right">0.274</td>
<td align="right">2.389</td>
<td align="right">0.017</td>
</tr>
<tr class="even">
<td align="left">wdNW</td>
<td align="right">-0.278</td>
<td align="right">0.259</td>
<td align="right">-1.076</td>
<td align="right">0.282</td>
</tr>
<tr class="odd">
<td align="left">wdS</td>
<td align="right">-0.091</td>
<td align="right">0.293</td>
<td align="right">-0.312</td>
<td align="right">0.755</td>
</tr>
<tr class="even">
<td align="left">wdSE</td>
<td align="right">-0.696</td>
<td align="right">0.287</td>
<td align="right">-2.425</td>
<td align="right">0.015</td>
</tr>
<tr class="odd">
<td align="left">wdSSE</td>
<td align="right">-0.276</td>
<td align="right">0.301</td>
<td align="right">-0.916</td>
<td align="right">0.360</td>
</tr>
<tr class="even">
<td align="left">wdSSW</td>
<td align="right">-0.147</td>
<td align="right">0.281</td>
<td align="right">-0.523</td>
<td align="right">0.601</td>
</tr>
<tr class="odd">
<td align="left">wdSW</td>
<td align="right">-1.690</td>
<td align="right">0.264</td>
<td align="right">-6.414</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wdW</td>
<td align="right">-2.462</td>
<td align="right">0.300</td>
<td align="right">-8.199</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">wdWNW</td>
<td align="right">-1.394</td>
<td align="right">0.279</td>
<td align="right">-4.993</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">wdWSW</td>
<td align="right">-1.639</td>
<td align="right">0.288</td>
<td align="right">-5.687</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">wspm</td>
<td align="right">-0.443</td>
<td align="right">0.052</td>
<td align="right">-8.541</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">stationChangping</td>
<td align="right">4.431</td>
<td align="right">0.244</td>
<td align="right">18.196</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">stationDingling</td>
<td align="right">11.372</td>
<td align="right">0.252</td>
<td align="right">45.135</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">stationDongsi</td>
<td align="right">2.663</td>
<td align="right">0.240</td>
<td align="right">11.077</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">stationGuanyuan</td>
<td align="right">1.314</td>
<td align="right">0.236</td>
<td align="right">5.576</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">stationGucheng</td>
<td align="right">-2.366</td>
<td align="right">0.240</td>
<td align="right">-9.856</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">stationHuairou</td>
<td align="right">7.018</td>
<td align="right">0.251</td>
<td align="right">27.939</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">stationNongzhanguan</td>
<td align="right">1.994</td>
<td align="right">0.235</td>
<td align="right">8.496</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">stationShunyi</td>
<td align="right">6.851</td>
<td align="right">0.244</td>
<td align="right">28.064</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">stationTiantan</td>
<td align="right">2.868</td>
<td align="right">0.236</td>
<td align="right">12.169</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">stationWanliu</td>
<td align="right">-0.696</td>
<td align="right">0.240</td>
<td align="right">-2.902</td>
<td align="right">0.004</td>
</tr>
<tr class="even">
<td align="left">stationWanshouxigong</td>
<td align="right">0.614</td>
<td align="right">0.236</td>
<td align="right">2.604</td>
<td align="right">0.009</td>
</tr>
<tr class="odd">
<td align="left">seasonspring</td>
<td align="right">-13.535</td>
<td align="right">0.922</td>
<td align="right">-14.687</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">seasonsummer</td>
<td align="right">-19.795</td>
<td align="right">0.930</td>
<td align="right">-21.291</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">seasonwinter</td>
<td align="right">1.082</td>
<td align="right">0.797</td>
<td align="right">1.358</td>
<td align="right">0.175</td>
</tr>
<tr class="even">
<td align="left">seasonal_year</td>
<td align="right">-4.484</td>
<td align="right">0.386</td>
<td align="right">-11.625</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">season_andfall 2014</td>
<td align="right">-5.734</td>
<td align="right">0.410</td>
<td align="right">-13.982</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">season_andfall 2015</td>
<td align="right">-1.082</td>
<td align="right">0.648</td>
<td align="right">-1.670</td>
<td align="right">0.095</td>
</tr>
<tr class="odd">
<td align="left">season_andfall 2016</td>
<td align="right">-6.890</td>
<td align="right">0.914</td>
<td align="right">-7.536</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">season_andspring 2013</td>
<td align="right">5.622</td>
<td align="right">0.910</td>
<td align="right">6.178</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">season_andspring 2014</td>
<td align="right">-1.564</td>
<td align="right">0.639</td>
<td align="right">-2.448</td>
<td align="right">0.014</td>
</tr>
<tr class="even">
<td align="left">season_andspring 2015</td>
<td align="right">-6.313</td>
<td align="right">0.394</td>
<td align="right">-16.025</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">season_andsummer 2013</td>
<td align="right">4.266</td>
<td align="right">0.911</td>
<td align="right">4.682</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">season_andsummer 2014</td>
<td align="right">2.532</td>
<td align="right">0.639</td>
<td align="right">3.962</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">season_andsummer 2015</td>
<td align="right">-0.799</td>
<td align="right">0.395</td>
<td align="right">-2.023</td>
<td align="right">0.043</td>
</tr>
<tr class="even">
<td align="left">season_andwinter 2013</td>
<td align="right">-0.960</td>
<td align="right">0.747</td>
<td align="right">-1.284</td>
<td align="right">0.199</td>
</tr>
<tr class="odd">
<td align="left">season_andwinter 2014</td>
<td align="right">-1.359</td>
<td align="right">0.478</td>
<td align="right">-2.843</td>
<td align="right">0.004</td>
</tr>
</tbody>
</table>
</div>
<div id="mixed-model" class="section level3">
<h3>Mixed Model</h3>
<pre class="r"><code>all_df %&gt;% 
  lme4::lmer(pm2_5 ~ year + season + so2 + no2 + co + o3 + temp + dewp + rain + wd + wspm + (1 | station), data = .) %&gt;% 
  broom::tidy() %&gt;% 
  knitr::kable(digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="left">group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-1571.860</td>
<td align="right">131.345</td>
<td align="right">-11.967</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="right">0.772</td>
<td align="right">0.065</td>
<td align="right">11.843</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">seasonspring</td>
<td align="right">-8.107</td>
<td align="right">0.230</td>
<td align="right">-35.256</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">seasonsummer</td>
<td align="right">-28.170</td>
<td align="right">0.294</td>
<td align="right">-95.755</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">seasonwinter</td>
<td align="right">8.444</td>
<td align="right">0.245</td>
<td align="right">34.490</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">so2</td>
<td align="right">0.305</td>
<td align="right">0.005</td>
<td align="right">67.163</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">no2</td>
<td align="right">0.728</td>
<td align="right">0.004</td>
<td align="right">207.127</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">co</td>
<td align="right">0.038</td>
<td align="right">0.000</td>
<td align="right">390.292</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">o3</td>
<td align="right">0.250</td>
<td align="right">0.002</td>
<td align="right">130.725</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">-0.866</td>
<td align="right">0.017</td>
<td align="right">-51.273</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">dewp</td>
<td align="right">2.241</td>
<td align="right">0.013</td>
<td align="right">175.111</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">rain</td>
<td align="right">-1.190</td>
<td align="right">0.085</td>
<td align="right">-14.077</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdENE</td>
<td align="right">-2.723</td>
<td align="right">0.354</td>
<td align="right">-7.685</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdESE</td>
<td align="right">2.526</td>
<td align="right">0.386</td>
<td align="right">6.550</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdN</td>
<td align="right">1.053</td>
<td align="right">0.368</td>
<td align="right">2.858</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdNE</td>
<td align="right">-1.944</td>
<td align="right">0.339</td>
<td align="right">-5.737</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdNNE</td>
<td align="right">-2.277</td>
<td align="right">0.375</td>
<td align="right">-6.075</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdNNW</td>
<td align="right">1.923</td>
<td align="right">0.390</td>
<td align="right">4.933</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdNW</td>
<td align="right">2.151</td>
<td align="right">0.368</td>
<td align="right">5.839</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdS</td>
<td align="right">0.739</td>
<td align="right">0.418</td>
<td align="right">1.767</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdSE</td>
<td align="right">1.815</td>
<td align="right">0.409</td>
<td align="right">4.434</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdSSE</td>
<td align="right">1.990</td>
<td align="right">0.430</td>
<td align="right">4.631</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdSSW</td>
<td align="right">1.100</td>
<td align="right">0.400</td>
<td align="right">2.749</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdSW</td>
<td align="right">-1.142</td>
<td align="right">0.376</td>
<td align="right">-3.038</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdW</td>
<td align="right">-3.741</td>
<td align="right">0.428</td>
<td align="right">-8.738</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdWNW</td>
<td align="right">-0.615</td>
<td align="right">0.398</td>
<td align="right">-1.546</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdWSW</td>
<td align="right">-2.385</td>
<td align="right">0.411</td>
<td align="right">-5.799</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wspm</td>
<td align="right">4.219</td>
<td align="right">0.073</td>
<td align="right">57.781</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">sd_(Intercept).station</td>
<td align="right">7.310</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">station</td>
</tr>
<tr class="even">
<td align="left">sd_Observation.Residual</td>
<td align="right">42.580</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Residual</td>
</tr>
</tbody>
</table>
</div>
<div id="mixed-model-for-longitudinal-continuous-data" class="section level3">
<h3>Mixed Model for Longitudinal Continuous Data</h3>
<pre class="r"><code>mixed&lt;-all_df %&gt;% 
  lme4::lmer(pm2_5 ~ year + season + so2 + no2 + co + o3 + temp + dewp + rain + wd + wspm + datetime + (1 | station), data = .) 

mixed %&gt;% broom::tidy() %&gt;% knitr::kable(digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="left">group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-50701.822</td>
<td align="right">861.052</td>
<td align="right">-58.884</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="right">25.734</td>
<td align="right">0.437</td>
<td align="right">58.854</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">seasonspring</td>
<td align="right">-20.355</td>
<td align="right">0.312</td>
<td align="right">-65.209</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">seasonsummer</td>
<td align="right">-33.817</td>
<td align="right">0.309</td>
<td align="right">-109.505</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">seasonwinter</td>
<td align="right">-7.326</td>
<td align="right">0.366</td>
<td align="right">-20.010</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">so2</td>
<td align="right">0.276</td>
<td align="right">0.005</td>
<td align="right">60.756</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">no2</td>
<td align="right">0.729</td>
<td align="right">0.004</td>
<td align="right">208.209</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">co</td>
<td align="right">0.038</td>
<td align="right">0.000</td>
<td align="right">396.177</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">o3</td>
<td align="right">0.252</td>
<td align="right">0.002</td>
<td align="right">132.171</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">-0.892</td>
<td align="right">0.017</td>
<td align="right">-52.972</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">dewp</td>
<td align="right">2.234</td>
<td align="right">0.013</td>
<td align="right">175.342</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">rain</td>
<td align="right">-1.224</td>
<td align="right">0.084</td>
<td align="right">-14.535</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdENE</td>
<td align="right">-2.557</td>
<td align="right">0.353</td>
<td align="right">-7.248</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdESE</td>
<td align="right">2.392</td>
<td align="right">0.384</td>
<td align="right">6.229</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdN</td>
<td align="right">1.125</td>
<td align="right">0.367</td>
<td align="right">3.069</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdNE</td>
<td align="right">-1.945</td>
<td align="right">0.337</td>
<td align="right">-5.764</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdNNE</td>
<td align="right">-2.045</td>
<td align="right">0.373</td>
<td align="right">-5.480</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdNNW</td>
<td align="right">2.130</td>
<td align="right">0.388</td>
<td align="right">5.487</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdNW</td>
<td align="right">2.283</td>
<td align="right">0.367</td>
<td align="right">6.226</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdS</td>
<td align="right">0.760</td>
<td align="right">0.416</td>
<td align="right">1.827</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdSE</td>
<td align="right">1.550</td>
<td align="right">0.408</td>
<td align="right">3.802</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdSSE</td>
<td align="right">1.945</td>
<td align="right">0.428</td>
<td align="right">4.546</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdSSW</td>
<td align="right">1.083</td>
<td align="right">0.398</td>
<td align="right">2.719</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdSW</td>
<td align="right">-1.242</td>
<td align="right">0.374</td>
<td align="right">-3.319</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdW</td>
<td align="right">-3.541</td>
<td align="right">0.426</td>
<td align="right">-8.305</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wdWNW</td>
<td align="right">-0.271</td>
<td align="right">0.396</td>
<td align="right">-0.684</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">wdWSW</td>
<td align="right">-2.137</td>
<td align="right">0.409</td>
<td align="right">-5.220</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">wspm</td>
<td align="right">4.256</td>
<td align="right">0.073</td>
<td align="right">58.546</td>
<td align="left">fixed</td>
</tr>
<tr class="odd">
<td align="left">datetime</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">-57.728</td>
<td align="left">fixed</td>
</tr>
<tr class="even">
<td align="left">sd_(Intercept).station</td>
<td align="right">7.346</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">station</td>
</tr>
<tr class="odd">
<td align="left">sd_Observation.Residual</td>
<td align="right">42.396</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Residual</td>
</tr>
</tbody>
</table>
<div id="section" class="section level52">
<p></p>
</div>
<div id="section-1" class="section level52">
<p></p>
</div>
</div>
</div>
</div>
<div id="linking-to-health-data" class="section level1">
<h1>Linking to health data</h1>
<div id="section-2" class="section level52">
<p></p>
</div>
<div id="section-3" class="section level52">
<p></p>
</div>
<div id="is-pm-2.5-season-no2-or-co-associated-with-cvd" class="section level2">
<h2>Is pm 2.5, season, NO2, or CO associated with CVD?</h2>
<p>We used the following articles when preparing to analyze pollutions affect on AMI <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0204706">1</a>, <a href="https://www.nature.com/articles/7500453.pdf?origin=ppub">2</a></p>
<pre class="r"><code>cvd&lt;-read_csv(&quot;./patient_mi_data/patients_mi.csv&quot;) %&gt;% janitor::clean_names()</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   gender = col_character(),
##   `admission date(year)` = col_double(),
##   `admission date(month)` = col_double(),
##   `main discharge diagnosis` = col_character()
## )</code></pre>
<pre class="r"><code>cvd2&lt;- cvd %&gt;% 
  group_by(admission_date_year, admission_date_month, gender) %&gt;% 
  summarise(n = n()) %&gt;% 
  rename(year=admission_date_year) %&gt;%
  rename(month=admission_date_month)

pollution&lt;-all_df %&gt;%
  group_by(year, month) %&gt;% 
  summarize(avg_pm2_5=mean(pm2_5, na.rm=TRUE),
            avg_pm10=mean(pm10, na.rm=TRUE),
            avg_co=mean(co, na.rm=TRUE),
            avg_temp=mean(temp, na.rm=TRUE),
            avg_no2=mean(no2, na.rm=TRUE))

model_data &lt;- left_join(pollution, cvd2, by=c(&quot;year&quot;, &quot;month&quot;)) %&gt;% 
  na.omit() </code></pre>
<pre class="r"><code>model_data$time &lt;- as.yearmon(paste(model_data$year, model_data$month), &quot;%Y %m&quot;)

# Sys.getlocale(&quot;LC_TIME&quot;)
# 
# model_data&lt;-model_data %&gt;%
#    unite(time, c(month, year), sep = &quot;-&quot;, remove = FALSE) %&gt;%
#    mutate(time = parse_date_time(time, &quot;my&quot;), local=&quot;English_United States.1252&quot;)</code></pre>
</div>
<div id="time-series-of-ami-hospitalizations-grouping-by-gender" class="section level2">
<h2>Time Series of AMI Hospitalizations Grouping by Gender</h2>
<pre class="r"><code>model_data %&gt;%  
  ggplot(aes(x=time, y=n, color=avg_pm2_5, group=gender)) +
  geom_line()+
  geom_point(aes(size = avg_co))+
  scale_color_viridis(option = &quot;B&quot;)+
  ggtitle(&quot;Number of MI&#39;s by PM2.5 and Year/Month&quot;) </code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type yearmon. Defaulting to continuous.</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-24-1.png" width="90%" /></p>
<pre class="r"><code>model_data %&gt;%  
  ggplot(aes(x=time, y=n, color=avg_pm2_5, group=gender)) +
  geom_line()+
  geom_point()+
  scale_color_viridis(option = &quot;B&quot;)+
  ggtitle(&quot;Average PM2.5 by Years&quot;)</code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type yearmon. Defaulting to continuous.</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-25-1.png" width="90%" /></p>
<pre class="r"><code>model_data %&gt;%  
  ggplot(aes(x=time, y=n, color=avg_pm10, group=gender)) +
  geom_line()+
  geom_point()+
  scale_color_viridis(option = &quot;B&quot;)+
  ggtitle(&quot;Number of MI&#39;s by PM10 and Year/Month&quot;)</code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type yearmon. Defaulting to continuous.</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-26-1.png" width="90%" /></p>
<pre class="r"><code>model_data %&gt;%  
  ggplot(aes(x=time, y=n, color=avg_co, group=gender)) +
  geom_line()+
  geom_point()+
  scale_color_viridis(option = &quot;B&quot;)+
  ggtitle(&quot;Number of MI&#39;s by Carbon Monoxide and Year/Month&quot;)</code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type yearmon. Defaulting to continuous.</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-27-1.png" width="90%" /></p>
<pre class="r"><code>model_data %&gt;%  
  ggplot(aes(x=time, y=n, color=avg_no2, group=gender)) +
  geom_line()+
  geom_point()+
  scale_color_viridis(option = &quot;B&quot;)+
  ggtitle(&quot;Number of MI&#39;s by NO2 and Year/Month&quot;)</code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type yearmon. Defaulting to continuous.</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-28-1.png" width="90%" /></p>
<p>It does appear the hospitalizations are higher in winter months. Unfortunately, we will not be able to draw strong conclusions about the effect pollution on heart attacks since it is so strongly correlated with the month/season. We can try to control for temperature instead of month?</p>
<pre class="r"><code>model_data %&gt;%  
  ggplot(aes(x=month, y=n, color=avg_temp, group=gender)) +
  geom_line()+
  geom_point()+
  scale_color_viridis(option = &quot;B&quot;)+
  facet_wrap(year~.) +
  ggtitle(&quot;Number of MI&#39;s by Temperature and Year/Month&quot;)</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-29-1.png" width="90%" /></p>
<p>For the analysis we have to use month because we have no data on days of the month to separate analysis into seasons.</p>
<p>The count data we are using is the number of people admitted for MI per month.</p>
</div>
<div id="distribution-of-the-counts" class="section level2">
<h2>Distribution of the counts</h2>
<pre class="r"><code>count&lt;- cvd %&gt;% 
  group_by(admission_date_year, admission_date_month) %&gt;% 
  summarise(n = n()) %&gt;% 
  rename(year=admission_date_year) %&gt;%
  rename(month=admission_date_month)

count2&lt;-all_df %&gt;%
  group_by(year, month) %&gt;% 
  summarize(avg_pm2_5=mean(pm2_5, na.rm=TRUE),
            avg_pm10=mean(pm10, na.rm=TRUE),
            avg_co=mean(co, na.rm=TRUE),
            avg_temp=mean(temp, na.rm=TRUE),
            avg_no2=mean(no2, na.rm=TRUE))

count3 &lt;- left_join(count, count2, by=c(&quot;year&quot;, &quot;month&quot;)) %&gt;% 
  na.omit() 


count3 %&gt;%
  ggplot(aes(x = n)) + geom_histogram(aes(color = &quot;red&quot;)) + labs(title = &quot;Distribution of Counts of MI Data&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="report_files/figure-html/unnamed-chunk-30-1.png" width="90%" /></p>
<p>The counts appear to be normally distributed, no overdispersion appears to be present, although we have not formally checked.</p>
<p>We could use a rate for the population of beijing for each year (and month), but from 2014 to 2018, the annual growth rate has been 0.3 percent. Beijing’s population peaked at 21.73 million residents in 2016. <a href="https://www.newgeography.com/content/006258-beijing-and-shanghai-limit-population-growth">Source</a>. For this reason (population numbers have been fairly flat) we decided to just use pure count data.</p>
<p>The count data is in the following format:</p>
<pre class="r"><code>head(model_data)</code></pre>
<pre><code>## # A tibble: 6 x 10
## # Groups:   year [1]
##    year month avg_pm2_5 avg_pm10 avg_co avg_temp avg_no2 gender     n time 
##   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;int&gt; &lt;yea&gt;
## 1  2013     3     105.     129.   1457.     5.99    67.9 female   511 Mar ~
## 2  2013     3     105.     129.   1457.     5.99    67.9 male    1090 Mar ~
## 3  2013     4      62.1     95.9   903.    12.4     46.3 female   519 Apr ~
## 4  2013     4      62.1     95.9   903.    12.4     46.3 male    1135 Apr ~
## 5  2013     5      81.8    131.    999.    21.7     50.6 female   439 May ~
## 6  2013     5      81.8    131.    999.    21.7     50.6 male    1043 May ~</code></pre>
</div>
<div id="should-we-not-include-temp-most-is-significant-when-not-included." class="section level2">
<h2>Should we not include temp? Most is significant when not included.</h2>
<pre class="r"><code>m1 &lt;- glm(n ~ avg_pm2_5 + avg_pm10 + avg_co + avg_no2  + gender, family=&quot;poisson&quot;, data=model_data)

tab&lt;-m1 %&gt;% broom::tidy()
knitr::kable(tab, digits = 6)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">6.195519</td>
<td align="right">0.016903</td>
<td align="right">366.540815</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">avg_pm2_5</td>
<td align="right">-0.003976</td>
<td align="right">0.000405</td>
<td align="right">-9.829240</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">avg_pm10</td>
<td align="right">0.002459</td>
<td align="right">0.000321</td>
<td align="right">7.659630</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">avg_co</td>
<td align="right">0.000144</td>
<td align="right">0.000017</td>
<td align="right">8.385587</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">avg_no2</td>
<td align="right">-0.000869</td>
<td align="right">0.000707</td>
<td align="right">-1.229575</td>
<td align="right">0.218856</td>
</tr>
<tr class="even">
<td align="left">gendermale</td>
<td align="right">0.789288</td>
<td align="right">0.007736</td>
<td align="right">102.026556</td>
<td align="right">0.000000</td>
</tr>
</tbody>
</table>
</div>
<div id="including-temp" class="section level2">
<h2>Including temp?</h2>
<pre class="r"><code>m1 &lt;- glm(n ~ avg_pm2_5 + avg_pm10 + avg_co + avg_no2 + avg_temp + gender, family=&quot;poisson&quot;, data=model_data)

#avg_pm2_5*avg_temp + avg_co*avg_temp

tab&lt;-m1 %&gt;% broom::tidy()
knitr::kable(tab, digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">6.558</td>
<td align="right">0.031</td>
<td align="right">210.804</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">avg_pm2_5</td>
<td align="right">-0.001</td>
<td align="right">0.000</td>
<td align="right">-1.967</td>
<td align="right">0.049</td>
</tr>
<tr class="odd">
<td align="left">avg_pm10</td>
<td align="right">0.002</td>
<td align="right">0.000</td>
<td align="right">4.808</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">avg_co</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">-1.552</td>
<td align="right">0.121</td>
</tr>
<tr class="odd">
<td align="left">avg_no2</td>
<td align="right">-0.004</td>
<td align="right">0.001</td>
<td align="right">-5.636</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">avg_temp</td>
<td align="right">-0.009</td>
<td align="right">0.001</td>
<td align="right">-13.747</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">gendermale</td>
<td align="right">0.789</td>
<td align="right">0.008</td>
<td align="right">102.027</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
<div id="what-about-including-month-and-year" class="section level2">
<h2>What about including month and year??</h2>
<pre class="r"><code>model_data&lt;-model_data%&gt;% 
  mutate(month=factor(month))

m1 &lt;- glm(n ~ avg_pm2_5 + avg_pm10 + avg_co + avg_no2 + month + year + gender, family=&quot;poisson&quot;, data=model_data)

#avg_pm2_5*avg_temp + avg_co*avg_temp

tab&lt;-m1 %&gt;% broom::tidy()
knitr::kable(tab, digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-159.489</td>
<td align="right">8.401</td>
<td align="right">-18.985</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">avg_pm2_5</td>
<td align="right">0.004</td>
<td align="right">0.001</td>
<td align="right">4.550</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">avg_pm10</td>
<td align="right">-0.004</td>
<td align="right">0.001</td>
<td align="right">-8.247</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">avg_co</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">-1.420</td>
<td align="right">0.156</td>
</tr>
<tr class="odd">
<td align="left">avg_no2</td>
<td align="right">0.002</td>
<td align="right">0.001</td>
<td align="right">1.588</td>
<td align="right">0.112</td>
</tr>
<tr class="even">
<td align="left">month10</td>
<td align="right">-0.056</td>
<td align="right">0.042</td>
<td align="right">-1.328</td>
<td align="right">0.184</td>
</tr>
<tr class="odd">
<td align="left">month11</td>
<td align="right">0.061</td>
<td align="right">0.022</td>
<td align="right">2.843</td>
<td align="right">0.004</td>
</tr>
<tr class="even">
<td align="left">month12</td>
<td align="right">0.058</td>
<td align="right">0.020</td>
<td align="right">2.884</td>
<td align="right">0.004</td>
</tr>
<tr class="odd">
<td align="left">month2</td>
<td align="right">-0.108</td>
<td align="right">0.033</td>
<td align="right">-3.282</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">month3</td>
<td align="right">0.043</td>
<td align="right">0.036</td>
<td align="right">1.209</td>
<td align="right">0.227</td>
</tr>
<tr class="odd">
<td align="left">month4</td>
<td align="right">0.087</td>
<td align="right">0.047</td>
<td align="right">1.829</td>
<td align="right">0.067</td>
</tr>
<tr class="even">
<td align="left">month5</td>
<td align="right">0.135</td>
<td align="right">0.045</td>
<td align="right">3.001</td>
<td align="right">0.003</td>
</tr>
<tr class="odd">
<td align="left">month6</td>
<td align="right">-0.235</td>
<td align="right">0.043</td>
<td align="right">-5.488</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">month7</td>
<td align="right">-0.189</td>
<td align="right">0.051</td>
<td align="right">-3.712</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">month8</td>
<td align="right">-0.142</td>
<td align="right">0.042</td>
<td align="right">-3.393</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">month9</td>
<td align="right">-0.172</td>
<td align="right">0.039</td>
<td align="right">-4.444</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">0.082</td>
<td align="right">0.004</td>
<td align="right">19.825</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">gendermale</td>
<td align="right">0.789</td>
<td align="right">0.008</td>
<td align="right">102.027</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
</div>
<div id="including-both-temp-and-monthsyears" class="section level2">
<h2>Including both temp and months/years?</h2>
<pre class="r"><code>m1 &lt;- glm(n ~ avg_pm2_5 + avg_pm10 + avg_co + avg_no2 + month + year +avg_temp + gender, family=&quot;poisson&quot;, data=model_data)



tab&lt;-m1 %&gt;% broom::tidy()
knitr::kable(tab, digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-159.650</td>
<td align="right">8.680</td>
<td align="right">-18.393</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">avg_pm2_5</td>
<td align="right">0.004</td>
<td align="right">0.001</td>
<td align="right">4.545</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">avg_pm10</td>
<td align="right">-0.004</td>
<td align="right">0.001</td>
<td align="right">-7.821</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">avg_co</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">-1.371</td>
<td align="right">0.170</td>
</tr>
<tr class="odd">
<td align="left">avg_no2</td>
<td align="right">0.002</td>
<td align="right">0.001</td>
<td align="right">1.574</td>
<td align="right">0.115</td>
</tr>
<tr class="even">
<td align="left">month10</td>
<td align="right">-0.052</td>
<td align="right">0.069</td>
<td align="right">-0.757</td>
<td align="right">0.449</td>
</tr>
<tr class="odd">
<td align="left">month11</td>
<td align="right">0.063</td>
<td align="right">0.033</td>
<td align="right">1.939</td>
<td align="right">0.053</td>
</tr>
<tr class="even">
<td align="left">month12</td>
<td align="right">0.059</td>
<td align="right">0.023</td>
<td align="right">2.604</td>
<td align="right">0.009</td>
</tr>
<tr class="odd">
<td align="left">month2</td>
<td align="right">-0.107</td>
<td align="right">0.034</td>
<td align="right">-3.161</td>
<td align="right">0.002</td>
</tr>
<tr class="even">
<td align="left">month3</td>
<td align="right">0.046</td>
<td align="right">0.047</td>
<td align="right">0.961</td>
<td align="right">0.336</td>
</tr>
<tr class="odd">
<td align="left">month4</td>
<td align="right">0.091</td>
<td align="right">0.075</td>
<td align="right">1.211</td>
<td align="right">0.226</td>
</tr>
<tr class="even">
<td align="left">month5</td>
<td align="right">0.142</td>
<td align="right">0.097</td>
<td align="right">1.456</td>
<td align="right">0.145</td>
</tr>
<tr class="odd">
<td align="left">month6</td>
<td align="right">-0.228</td>
<td align="right">0.116</td>
<td align="right">-1.963</td>
<td align="right">0.050</td>
</tr>
<tr class="even">
<td align="left">month7</td>
<td align="right">-0.180</td>
<td align="right">0.129</td>
<td align="right">-1.400</td>
<td align="right">0.162</td>
</tr>
<tr class="odd">
<td align="left">month8</td>
<td align="right">-0.133</td>
<td align="right">0.124</td>
<td align="right">-1.077</td>
<td align="right">0.282</td>
</tr>
<tr class="even">
<td align="left">month9</td>
<td align="right">-0.166</td>
<td align="right">0.098</td>
<td align="right">-1.699</td>
<td align="right">0.089</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">0.082</td>
<td align="right">0.004</td>
<td align="right">19.206</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">avg_temp</td>
<td align="right">0.000</td>
<td align="right">0.004</td>
<td align="right">-0.073</td>
<td align="right">0.941</td>
</tr>
<tr class="odd">
<td align="left">gendermale</td>
<td align="right">0.789</td>
<td align="right">0.008</td>
<td align="right">102.027</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Interestingly,</td>
<td align="right">all of the</td>
<td align="right">variables a</td>
<td align="right">re significa</td>
<td align="right">nt here.</td>
</tr>
</tbody>
</table>
</div>
<div id="is-an-outlier-with-a-large-number-of-mis." class="section level2">
<h2>2016 is an outlier with a large number of MI’s.</h2>
<p>2016 may be skewing our result so a seperate set of analyses was completed excluding 2016.</p>
<pre class="r"><code>model_data2&lt;-model_data %&gt;% 
  filter(year!=2016)

m1 &lt;- glm(n ~ avg_pm2_5 + avg_pm10 + avg_co + avg_no2 + month + year +avg_temp + gender, family=&quot;poisson&quot;, data=model_data2)

tab&lt;-m1 %&gt;% broom::tidy()
knitr::kable(tab, digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-112.383</td>
<td align="right">16.142</td>
<td align="right">-6.962</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">avg_pm2_5</td>
<td align="right">0.000</td>
<td align="right">0.001</td>
<td align="right">0.205</td>
<td align="right">0.838</td>
</tr>
<tr class="odd">
<td align="left">avg_pm10</td>
<td align="right">-0.001</td>
<td align="right">0.001</td>
<td align="right">-1.026</td>
<td align="right">0.305</td>
</tr>
<tr class="even">
<td align="left">avg_co</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.796</td>
<td align="right">0.426</td>
</tr>
<tr class="odd">
<td align="left">avg_no2</td>
<td align="right">-0.001</td>
<td align="right">0.002</td>
<td align="right">-0.271</td>
<td align="right">0.787</td>
</tr>
<tr class="even">
<td align="left">month10</td>
<td align="right">0.203</td>
<td align="right">0.090</td>
<td align="right">2.248</td>
<td align="right">0.025</td>
</tr>
<tr class="odd">
<td align="left">month11</td>
<td align="right">0.092</td>
<td align="right">0.042</td>
<td align="right">2.186</td>
<td align="right">0.029</td>
</tr>
<tr class="even">
<td align="left">month12</td>
<td align="right">0.007</td>
<td align="right">0.027</td>
<td align="right">0.262</td>
<td align="right">0.793</td>
</tr>
<tr class="odd">
<td align="left">month2</td>
<td align="right">-0.094</td>
<td align="right">0.045</td>
<td align="right">-2.117</td>
<td align="right">0.034</td>
</tr>
<tr class="even">
<td align="left">month3</td>
<td align="right">0.119</td>
<td align="right">0.057</td>
<td align="right">2.097</td>
<td align="right">0.036</td>
</tr>
<tr class="odd">
<td align="left">month4</td>
<td align="right">0.208</td>
<td align="right">0.097</td>
<td align="right">2.156</td>
<td align="right">0.031</td>
</tr>
<tr class="even">
<td align="left">month5</td>
<td align="right">0.242</td>
<td align="right">0.128</td>
<td align="right">1.886</td>
<td align="right">0.059</td>
</tr>
<tr class="odd">
<td align="left">month6</td>
<td align="right">0.119</td>
<td align="right">0.156</td>
<td align="right">0.765</td>
<td align="right">0.445</td>
</tr>
<tr class="even">
<td align="left">month7</td>
<td align="right">0.238</td>
<td align="right">0.175</td>
<td align="right">1.358</td>
<td align="right">0.175</td>
</tr>
<tr class="odd">
<td align="left">month8</td>
<td align="right">0.250</td>
<td align="right">0.167</td>
<td align="right">1.500</td>
<td align="right">0.134</td>
</tr>
<tr class="even">
<td align="left">month9</td>
<td align="right">0.173</td>
<td align="right">0.129</td>
<td align="right">1.336</td>
<td align="right">0.181</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">0.059</td>
<td align="right">0.008</td>
<td align="right">7.375</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">avg_temp</td>
<td align="right">-0.013</td>
<td align="right">0.006</td>
<td align="right">-2.231</td>
<td align="right">0.026</td>
</tr>
<tr class="odd">
<td align="left">gendermale</td>
<td align="right">0.788</td>
<td align="right">0.009</td>
<td align="right">85.298</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<p>Now it appears that neither of the two pollution measures are significantly associated with MI.</p>
</div>
<div id="what-if-we-do-not-include-month-and-year" class="section level2">
<h2>What if we do not include month and year?</h2>
<pre class="r"><code>m1 &lt;- glm(n ~ avg_pm2_5 + avg_pm10 + avg_co + avg_no2  + gender, family=&quot;poisson&quot;, data=model_data2)

tab&lt;-m1 %&gt;% broom::tidy()
knitr::kable(tab, digits = 6)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">6.027276</td>
<td align="right">0.022318</td>
<td align="right">270.067311</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">avg_pm2_5</td>
<td align="right">-0.002491</td>
<td align="right">0.000447</td>
<td align="right">-5.572765</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">avg_pm10</td>
<td align="right">0.001153</td>
<td align="right">0.000374</td>
<td align="right">3.083456</td>
<td align="right">0.002046</td>
</tr>
<tr class="even">
<td align="left">avg_co</td>
<td align="right">0.000121</td>
<td align="right">0.000019</td>
<td align="right">6.307927</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">avg_no2</td>
<td align="right">0.002295</td>
<td align="right">0.000778</td>
<td align="right">2.950562</td>
<td align="right">0.003172</td>
</tr>
<tr class="even">
<td align="left">gendermale</td>
<td align="right">0.787605</td>
<td align="right">0.009234</td>
<td align="right">85.298203</td>
<td align="right">0.000000</td>
</tr>
</tbody>
</table>
<p>Now all of the variables are significantly associated with MI. This may be the most parsimonious model, but we can not make any causal asumptions.</p>
</div>
<div id="what-if-we-add-interaction-of-temperature-with-relevant-variables" class="section level2">
<h2>What if we add interaction of temperature with relevant variables?</h2>
<pre class="r"><code>m2 &lt;- glm(n ~  avg_pm2_5 + avg_pm10 + avg_co + avg_no2 + gender + avg_temp*avg_pm2_5 + avg_temp*avg_pm10 + avg_temp*avg_co + avg_temp*avg_no2, family=&quot;poisson&quot;, data=model_data2)

tab&lt;-m2 %&gt;% broom::tidy()
knitr::kable(tab, digits = 6)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">6.255528</td>
<td align="right">0.074958</td>
<td align="right">83.453634</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">avg_pm2_5</td>
<td align="right">-0.000339</td>
<td align="right">0.000779</td>
<td align="right">-0.434447</td>
<td align="right">0.663964</td>
</tr>
<tr class="odd">
<td align="left">avg_pm10</td>
<td align="right">0.000679</td>
<td align="right">0.000861</td>
<td align="right">0.788775</td>
<td align="right">0.430243</td>
</tr>
<tr class="even">
<td align="left">avg_co</td>
<td align="right">-0.000016</td>
<td align="right">0.000037</td>
<td align="right">-0.417864</td>
<td align="right">0.676047</td>
</tr>
<tr class="odd">
<td align="left">avg_no2</td>
<td align="right">0.000594</td>
<td align="right">0.001743</td>
<td align="right">0.340874</td>
<td align="right">0.733198</td>
</tr>
<tr class="even">
<td align="left">gendermale</td>
<td align="right">0.787605</td>
<td align="right">0.009234</td>
<td align="right">85.298203</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">avg_temp</td>
<td align="right">0.002728</td>
<td align="right">0.003612</td>
<td align="right">0.755368</td>
<td align="right">0.450028</td>
</tr>
<tr class="even">
<td align="left">avg_pm2_5:avg_temp</td>
<td align="right">0.000021</td>
<td align="right">0.000053</td>
<td align="right">0.384101</td>
<td align="right">0.700903</td>
</tr>
<tr class="odd">
<td align="left">avg_pm10:avg_temp</td>
<td align="right">-0.000027</td>
<td align="right">0.000052</td>
<td align="right">-0.528269</td>
<td align="right">0.597312</td>
</tr>
<tr class="even">
<td align="left">avg_co:avg_temp</td>
<td align="right">-0.000009</td>
<td align="right">0.000003</td>
<td align="right">-3.020829</td>
<td align="right">0.002521</td>
</tr>
<tr class="odd">
<td align="left">avg_no2:avg_temp</td>
<td align="right">0.000010</td>
<td align="right">0.000104</td>
<td align="right">0.095229</td>
<td align="right">0.924133</td>
</tr>
</tbody>
</table>
<p>We can see that all of the variables, apart from the interaction of temperature and CO are no longer significant. It is possible that this study does not have enough power to assess interactions, since we only have month wide data. This is especially true when we filter out 2016.</p>
</div>
<div id="we-will-assess-model-fit-by-comparing-our-two-most-probably-models-in-anova" class="section level2">
<h2>We will assess model fit by comparing our two most probably models in ANOVA</h2>
<p>The full model formally has a better fit, but is also more difficult to intepret.</p>
<pre class="r"><code>anova(m1,m2, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: n ~ avg_pm2_5 + avg_pm10 + avg_co + avg_no2 + gender
## Model 2: n ~ avg_pm2_5 + avg_pm10 + avg_co + avg_no2 + gender + avg_temp * 
##     avg_pm2_5 + avg_temp * avg_pm10 + avg_temp * avg_co + avg_temp * 
##     avg_no2
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1        62     328.33                          
## 2        57     241.77  5   86.562 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>
<div id="discussion" class="section level1">
<h1>Discussion</h1>
<p>After extensive visualization and modeling of variables in our data we have gained a number of valuable insights regarding Beijing air quality from 2013-2017. Of the meteorological predictors we examined, rain, wind, and temperature were found to be negatively associated with PM2.5. This is consistent with previous findings. There were also strong seasonal variations in air quality, likely attributable to changes in the aforementioned weather variables. PM2.5 was highest across winter and fall seasons, and lowest across spring and summer seasons, for all stations. In concert with the natural decrease of temperature and wind during the winter, we suspect that an upsurge in coal heating also explains the seasonal PM2.5 increase. Visualization of temporal trends demonstrates that pollution was highest in 2014 and 2017, and drastically lower in 2016. The lower average in 2013 may be partially attributable to the absence of data from two winter months. The stations with average PM2.5 concentrations greater than or equal to 100 ug/m3- Nongzhanguan, Dongsi, Wanshouxigong, Gucheng- were all located near the city center. Peripheral stations had relatively lower concentrations.</p>
<p>Further integration of health data into our analysis produced results that were somewhat less anticipated. Visual examination of plots gives the impression that there are slightly more MIs with increasing pollutants, including PM2.5, PM10, CO, and NO2. However, when modeling the data with Poisson regression it appears that there are no significant associations between PM2.5, PM10 when using the full dataset. We considered the year 2016 as an outlier and removed it from the model, when only including pollutants and gender, the pollutants were significant and positive (except PM 2.5), but we can not draw strong conclusions.</p>
<p>This could be due to our model specifications. When examining the count distribution, the data appeared to be more Gaussian than poisson, and we may not have include the correct combination of covariates and interaction terms. A further problem was that we did not have acces to days of the month, so seasonal variables could not be used for the analysis, only months.</p>
<p>In the medical literature, clinicians have noted an increase in cardiovascular disease, and MIs in particular, during the winter months dating back to the 1930s. This finding has been validated across multiple databases and sites worldwide. However, the pathophysiologic mechanism driving this association remains somewhat unclear. Recent evidence has hypothesized that winter weather conditions and cold temperatures may induce physiologic stress including sympathetic activation (thereby increasing blood pressure and heart rate), hypercoagulability, inflammatory markers, and infection which mediate this increase in cardiovascular disease. Age and gender interactions with season and weather have been described. Although we do not find a clear association between air quality, temperature and incident MIs, there may be a number of possible explanations. We used air quality and cardiovascular outcome data from a single city, Beijing, which collected data from multiple sites across the city. Given that the cardiovascular data was collected from a subset of hospitals in Beijing, as not all hospitals were equipped with electronic health records during that time, and we do not have information on the data validation process or quality metrics (including the notable spike in MIs in 2016), the MI data may not be representative of either the general population in Beijing or the population around the air quality reporting sites specifically. In addition, atherosclerosis and coronary artery disease is generally a chronic, multi-factorial process where both risk and mitigating factors such as medications accumulate over time, so there may be unmeasured cardiovascular risk factors or other residual confounding to better explain the MI patterns in Beijing.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
